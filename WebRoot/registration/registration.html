<!DOCTYPE html>
<html>
<head>
    <title>智慧医疗云系统 - 用户注册</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../business/css/login.css">
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h1>智慧医疗云系统 - 用户注册</h1>
        </div>
        
        <div class="login-form">
            <form method="post" action="../servlet/registration/RegistrationServlet" id="registrationForm">
                <div class="form-group">
                    <label for="name">姓名</label>
                    <input type="text" id="name" name="name" required placeholder="请输入您的姓名">
                </div>
                
                <div class="form-group">
                    <label for="phone">联系电话</label>
                    <input type="tel" id="phone" name="phone" required placeholder="请输入您的联系电话" pattern="[0-9]{11}" title="请输入11位手机号码">
                </div>
                
                <div class="form-group">
                    <label for="role">身份</label>
                    <select id="role" name="role" required>
                        <option value="">请选择身份</option>
                        <option value="patient">患者</option>
                        <option value="doctor">医生</option>
                        <option value="nurse">护士</option>
                        <option value="finance">财务</option>
                        <option value="executive">医院高管</option>
                        <option value="enterprise">医疗相关企业</option>
                        <option value="university">医疗相关高校</option>
                    </select>
                </div>
                
                <div style="text-align: right; padding: 10px 0px;">
                    <a href="../login/patient-login.html" style="color: #42A2FF; text-decoration: none;">已有账号，去登录</a>
                </div>
        
                <div class="form-actions">
                    <input type="submit" name="registerbutton" value="注册">
                    <input type="reset" value="重置">
                </div>
            </form>
        </div>
        
        <div class="login-footer">
            <p>智慧医疗云系统 &copy; 2025</p>
        </div>
    </div>

    <script type="text/javascript">
        // 获取来源登录页面（从URL参数或referrer）
        function getReturnLoginPage() {
            const urlParams = new URLSearchParams(window.location.search);
            const returnPage = urlParams.get('return');
            if (returnPage) {
                return returnPage;
            }
            // 如果没有参数，默认返回患者登录页
            return '../login/patient-login.html';
        }
        
        // 显示倒计时提示框
        function showCountdownModal(returnPage) {
            // 创建遮罩层 - 灰色背景，完全遮挡页面内容
            const overlay = document.createElement('div');
            overlay.id = 'countdown-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(128, 128, 128, 0.95); z-index: 10000; display: flex; justify-content: center; align-items: center;';
            
            // 创建提示框
            const modal = document.createElement('div');
            modal.style.cssText = 'background: white; padding: 30px 40px; border-radius: 8px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.5); min-width: 300px; z-index: 10001; position: relative;';
            
            const title = document.createElement('h2');
            title.textContent = '注册成功！';
            title.style.cssText = 'color: #42A2FF; margin-bottom: 20px; font-size: 24px;';
            
            const message = document.createElement('p');
            message.style.cssText = 'font-size: 16px; color: #333; margin-bottom: 10px;';
            
            const countdownSpan = document.createElement('span');
            countdownSpan.id = 'countdown-number';
            countdownSpan.style.cssText = 'color: #42A2FF; font-weight: bold; font-size: 18px;';
            countdownSpan.textContent = '3';
            
            message.appendChild(document.createTextNode('等待 '));
            message.appendChild(countdownSpan);
            message.appendChild(document.createTextNode(' 秒后，自动跳转至登录界面'));
            
            modal.appendChild(title);
            modal.appendChild(message);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // 倒计时
            let countdown = 3;
            const countdownElement = countdownSpan; // 直接使用创建的span元素
            
            const timer = setInterval(function() {
                countdown--;
                if (countdown > 0) {
                    countdownElement.textContent = countdown;
                } else {
                    clearInterval(timer);
                    countdownElement.textContent = '0';
                    // 跳转到登录页面
                    setTimeout(function() {
                        window.location.href = returnPage;
                    }, 500); // 延迟500ms显示0，然后跳转
                }
            }, 1000);
        }
        
        // 表单验证和提交处理
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const role = document.getElementById('role').value;
            
            if (!name) {
                alert('请输入姓名');
                e.preventDefault();
                return false;
            }
            
            if (!phone) {
                alert('请输入联系电话');
                e.preventDefault();
                return false;
            }
            
            // 验证手机号格式（11位数字）
            const phonePattern = /^1[3-9]\d{9}$/;
            if (!phonePattern.test(phone)) {
                alert('请输入正确的11位手机号码');
                e.preventDefault();
                return false;
            }
            
            if (!role) {
                alert('请选择身份');
                e.preventDefault();
                return false;
            }
            
            // 阻止默认提交，显示倒计时提示
            e.preventDefault();
            
            // 获取返回的登录页面
            const returnPage = getReturnLoginPage();
            
            // 显示倒计时提示框
            showCountdownModal(returnPage);
            
            // 这里可以添加实际的注册逻辑（AJAX提交到后端）
            // 目前先模拟注册成功
            return false;
        });
    </script>
</body>
</html>

